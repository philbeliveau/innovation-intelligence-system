# Story 10.9: navigation-update-runcard

## Status
Approved

## Story
**As a** user,
**I want** the "View" button on run cards to navigate to the pipeline visualization page,
**so that** I can see the full pipeline analysis instead of just the results summary

## Acceptance Criteria

1. "View" button in `RunCard` component navigates to `/pipeline/[runId]` instead of `/runs/[runId]`
2. Navigation change applies to all run cards (home page, runs list, etc.)
3. Existing pipeline visualization page handles the navigation correctly
4. No broken links or 404 errors after change
5. Run card styling and other functionality remains unchanged

## Tasks / Subtasks

- [ ] Update RunCard navigation (AC: 1)
  - [ ] Locate `handleView()` function in RunCard component
  - [ ] Change route from `/runs/[runId]` to `/pipeline/[runId]`
  - [ ] Test navigation works correctly
- [ ] Verify all RunCard usage locations (AC: 2)
  - [ ] Check home page run cards
  - [ ] Check runs list page
  - [ ] Check any other pages using RunCard
  - [ ] Ensure all locations work with new route
- [ ] Test pipeline page load (AC: 3)
  - [ ] Verify pipeline page loads correctly from RunCard click
  - [ ] Verify retrospective mode activates for completed runs
  - [ ] Verify live mode activates for in-progress runs
- [ ] Verify no broken links (AC: 4)
  - [ ] Test all run card locations
  - [ ] Check console for errors
  - [ ] Verify no 404 errors in network tab
- [ ] Regression testing (AC: 5)
  - [ ] Verify run card styling unchanged
  - [ ] Verify delete button still works
  - [ ] Verify other run card actions still work

## Dev Notes

**Relevant Source Tree:**
- `innovation-web/components/RunCard.tsx` - Main run card component
- `innovation-web/app/page.tsx` - Home page using RunCard
- `innovation-web/app/runs/page.tsx` - Runs list page using RunCard (if exists)
- `innovation-web/app/pipeline/[runId]/page.tsx` - Target destination

**Current Implementation:**
```typescript
// innovation-web/components/RunCard.tsx

const handleView = () => {
  router.push(`/runs/${run.id}`)  // OLD ROUTE
}
```

**New Implementation:**
```typescript
// innovation-web/components/RunCard.tsx

const handleView = () => {
  router.push(`/pipeline/${run.id}`)  // NEW ROUTE
}
```

**Change Impact:**
- **One-line change** in RunCard component
- No other files need modification
- Pipeline page already handles both live and retrospective modes (Story 10.7)
- No styling or functional changes to RunCard itself

**User Experience Change:**
- **Before**: Click "View" → Navigate to `/runs/[runId]` (results summary page)
- **After**: Click "View" → Navigate to `/pipeline/[runId]` (full pipeline visualization)

**Why This Change:**
- Unifies user experience around single pipeline visualization page
- Removes redundant `/runs/[runId]` results page
- Pipeline page now supports retrospective mode for completed runs
- More context-rich view for users (shows stage outputs, not just final cards)

**Important Constraints:**
- DO NOT modify run card styling
- DO NOT modify other run card actions (delete, etc.)
- DO NOT modify RunCard component beyond navigation change
- Pipeline page MUST handle the route correctly (dependency on Story 10.7)

**Edge Cases:**
- Old runs without stage outputs: Pipeline page shows fallback (Story 10.10)
- Failed runs: Pipeline page shows error state
- Cancelled runs: Pipeline page shows cancelled state
- In-progress runs: Pipeline page shows live mode

**Dependencies:**
- Requires Story 10.7 (pipeline state machine) to be completed
- Requires pipeline page to handle retrospective mode correctly
- May deprecate `/runs/[runId]` page (if it exists)

**Testing Focus:**
- Single-line change means low risk
- Focus on integration testing (navigation flow)
- Verify pipeline page loads correctly from run card click
- No need for extensive unit testing (trivial change)

### Testing

**Test File Location:**
- `innovation-web/components/RunCard.test.tsx` (update existing test)
- Manual integration testing (click through user flow)

**Testing Standards:**
- Use Jest with React Testing Library
- Mock Next.js router
- Test navigation behavior

**Testing Frameworks:**
- Jest for unit testing
- React Testing Library for component testing

**Specific Testing Requirements:**

1. **RunCard Navigation Test:**
   ```typescript
   import { render, screen, fireEvent } from '@testing-library/react'
   import { useRouter } from 'next/navigation'
   import { RunCard } from './RunCard'

   jest.mock('next/navigation', () => ({
     useRouter: jest.fn()
   }))

   test('View button navigates to pipeline page', () => {
     const mockPush = jest.fn()
     ;(useRouter as jest.Mock).mockReturnValue({ push: mockPush })

     const run = {
       id: 'test-run-id',
       documentName: 'test.pdf',
       status: 'COMPLETED',
       createdAt: new Date().toISOString()
     }

     render(<RunCard run={run} />)

     const viewButton = screen.getByText('View')
     fireEvent.click(viewButton)

     expect(mockPush).toHaveBeenCalledWith('/pipeline/test-run-id')
   })
   ```

2. **Integration Testing:**
   - Navigate to home page
   - Click "View" on a completed run card
   - Verify pipeline page loads
   - Verify retrospective mode activates
   - Verify stage outputs display (if available)
   - Navigate back and test with in-progress run
   - Verify live mode activates

**Manual Testing Checklist:**
- [ ] Navigate to home page
- [ ] Find a completed run card
- [ ] Click "View" button
- [ ] Verify navigates to `/pipeline/[runId]`
- [ ] Verify pipeline page loads correctly
- [ ] Verify retrospective mode shows (if completed)
- [ ] Go back to home page
- [ ] Find an in-progress run card
- [ ] Click "View" button
- [ ] Verify navigates to `/pipeline/[runId]`
- [ ] Verify live mode shows (if in progress)
- [ ] Test delete button still works
- [ ] Verify run card styling unchanged

**Success Metrics:**
- All run card "View" buttons navigate to `/pipeline/[runId]`
- Pipeline page loads correctly from run card navigation
- No 404 errors or broken links
- Run card styling and other actions unchanged
- User experience improved (more context in pipeline view)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-29 | 1.0 | Initial story creation from Pipeline Persistence Epic | John (PM) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
